<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events Overlay</title>
    <style>
        body {
            background: transparent;
            margin: 0;
        }

        #overlay {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .overlay-unit {
            position: absolute;
            pointer-events: none;
        }

        .overlay-image {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            will-change: opacity;
        }
    </style>
</head>

<body>
    <div id="overlay"></div>

    <script>
        const ws = new WebSocket('ws://localhost:3002');
        const status = document.getElementById('sound-status');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            switch (data.type) {
                case 'play_sound':
                    handlePlaySound(data);
                    break;
                case 'show_image':
                    handleShowImage(data);
                    break;
                case 'guess_emote':
                    handleGuessEmote(data);
                default:
                    break;
            }
        };

        function handlePlaySound(data) {
            const player = new Audio(data.url);
            player.playbackRate = data.playbackSpeed || 1;
            player.volume = data.volume;
            player.play();
            player.onended = () => player.remove();
        }

        function handleShowImage(data) {
            const img = document.createElement('img');
            img.src = data.data;
            img.className = 'overlay-unit overlay-image';

            img.style.left = (data.x || 0) + 'px';
            img.style.top = (data.y || 0) + 'px';

            document.getElementById('overlay').appendChild(img);

            requestAnimationFrame(() => img.style.opacity = 1);

            setTimeout(() => {
                img.style.opacity = 0;
                img.addEventListener('transitionend', () => img.remove(), { once: true });
            }, data.duration || (3000 - 500));
        }
    </script>
</body>

</html>