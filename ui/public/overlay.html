<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Streak Overlay</title>
    <style>
        body {
            background: transparent;
            margin: 0;
        }

        #sound-status {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 2em;
        }

        .overlay-image {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
    </style>
</head>

<body>
    <div id="sound-status"></div>
    <script>
        const ws = new WebSocket('ws://localhost:3002');
        const status = document.getElementById('sound-status');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            // Handle sound event
            if (data.type === 'play_sound') {
                // Create a new audio element for each sound
                const player = new Audio(data.url);
                player.playbackRate = data.playbackSpeed || 1;
                player.volume = data.volume;
                player.play();
                status.textContent = `Playing: ${data.sound}`;
                setTimeout(() => { status.textContent = ''; }, 2000);

                player.onended = () => player.remove();
            } else if (data.type === 'show_image') {
                const img = document.createElement('img');
                img.src = data.data;
                img.className = 'overlay-image';

                img.style.left = (data.x || 0) + 'px';
                img.style.top = (data.y || 0) + 'px';

                document.body.appendChild(img);

                requestAnimationFrame(() => {
                    img.style.opacity = 1;
                });

                setTimeout(() => {
                    img.style.opacity = 0;
                    img.addEventListener("transitionend", () => img.remove(), { once: true });
                }, data.duration || 3000);
            }
        };
    </script>
</body>

</html>